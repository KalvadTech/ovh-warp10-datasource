{"version":3,"sources":["../src/ext-language_tools.js"],"names":["window","ace","define","require","exports","module","oop","EventEmitter","lang","Range","Anchor","HashHandler","Tokenizer","comparePoints","SnippetManager","snippetMap","snippetNameMap","implement","getTokenizer","TabstopToken","str","_","stack","substr","test","inFormatString","tabstopId","parseInt","text","escape","ch","$tokenizer","start","regex","onMatch","val","state","length","expectIf","elseBranch","indexOf","changeCase","local","shift","t","unshift","next","token","merge","snippetVar","choices","slice","split","ts","fmtString","splitRegex","exec","guard","fmt","flag","code","splice","formatString","prototype","tokenizeTmSnippet","startState","getLineTokens","tokens","map","x","value","$getDefaultValue","editor","name","i","variables","__","replace","s","session","r","getWordRange","getTextRange","getLine","getCursorPosition","row","column","getUseSoftTabs","getTabSize","getVariableValue","varName","hasOwnProperty","tmStrFormat","re","RegExp","fmtTokens","_self","formatted","arguments","fmtParts","resolveVariables","gChangeCase","toUpperCase","toLowerCase","join","snippet","result","push","skip","gotoNext","processed","i1","insertSnippetForSelection","snippetText","cursor","line","tabString","getTabString","indentString","match","tabstops","forEach","p","id","index","isNested","some","expanding","copyValue","copy","j","lastIndexOf","arg","Math","max","apply","lines","end","range","getSelectionRange","tabstopManager","TabstopManager","selectionId","inVirtualSelectionMode","selection","addTabstops","insertSnippet","self","forEachSelection","keepOrder","tabNext","$getScope","scope","$mode","$id","pop","inlinePhp","c","getState","substring","getActiveScopes","scopes","includeScopes","expandWithTab","options","expandSnippetForSelection","before","after","snippets","findMatchingSnippet","dryRun","doc","removeInLine","replaceBefore","replaceAfter","M__","matchBefore","T__","matchAfter","content","snippetList","startRe","endRe","triggerRe","endTriggerRe","register","wrapRegexp","src","guardedRegexp","opening","addSnippet","old","unregister","tabTrigger","trigger","escapeRegExp","endTrigger","endGuard","Array","isArray","_signal","removeSnippet","nameMap","parseSnippetFile","list","m","JSON","parse","e","key","guardRe","getSnippetByName","call","$onChange","onChange","bind","$onChangeSelection","delayedCall","onChangeSelection","schedule","$onChangeSession","onChangeSession","$onAfterExec","onAfterExec","attach","ranges","$openTabstops","selectedTabstop","on","commands","keyBinding","addKeyboardHandler","keyboardHandler","detach","removeTabstopMarkers","removeListener","removeKeyboardHandler","delta","changeRange","isRemove","action","startRow","endRow","lineDif","colDiff","$inChange","changedOutside","removeRange","updateLinkedFields","hasLinkedRanges","firstNonLinked","linked","snippetManager","original","command","readOnly","lead","anchor","isEmpty","containsLead","contains","containsAnchor","dir","min","selectTabstop","addTabstopMarkers","sel","multiSelect","toSingleRange","clone","addRange","setRange","fromPoints","moveRelative","dest","movePoint","tabstop","markerId","addMarker","removeMarker","bindKeys","ed","changeTracker","setPosition","pos","update","$insertRight","point","diff","importCssString","Editor","expandSnippet","Renderer","VirtualRenderer","event","dom","$singleLineEditor","el","renderer","$maxLines","setHighlightActiveLine","setShowPrintMargin","setShowGutter","setHighlightGutterLine","$mouseHandler","$focusWaitTimout","$highlightTagPending","AcePopup","parentNode","createElement","popup","appendChild","style","display","setStyle","setOption","noop","focus","$isFocused","$cursorLayer","restartTimer","element","opacity","$keepTextAreaAtCursor","highlight","$searchHighlight","clazz","getDocumentPosition","moveToPosition","selectionMarker","stop","lastMouseEvent","hoverMarker","Infinity","setSelectOnHover","y","scrollTop","setRow","setHoverMarker","$pos","getRow","$textLayer","selected","childNodes","config","firstRow","selectedNode","removeCssClass","addCssClass","hideHoverMarker","suppressRedraw","_emit","getHoveredRow","addListener","container","getLength","data","bgTokenizer","$tokenizeRow","caption","last","matchMask","type","className","meta","maxW","$size","scrollerWidth","layerConfig","characterWidth","metaData","$updateOnChange","$computeWidth","screenWidth","$blockScrolling","isOpen","isTopdown","setData","setValue","stringRepeat","getData","clearSelection","moveCursorTo","scrollCursorIntoView","hide","show","lineHeight","topdownOnly","screenHeight","innerHeight","innerWidth","maxH","top","$borderSize","allowTopdown","$maxPixelHeight","bottom","checkForSizeChanges","left","offsetWidth","getTextLeftOffset","$padding","$imageSize","parForEach","array","fn","callback","completed","arLength","err","ID_REGEX","retrievePrecedingIdentifier","buf","reverse","retrieveFollowingIdentifier","getCompletionPrefix","prefix","completers","completer","identifierRegexps","identifierRegex","util","Autocomplete","autoInsert","autoSelect","exactMatch","gatherCompletionsId","blurListener","changeListener","mousedownListener","mousewheelListener","changeTimer","updateCompletions","tooltipTimer","updateDocTooltip","$init","document","body","documentElement","insertMatch","getPopup","openPopup","keepPopupPosition","completions","filtered","setTheme","getTheme","setFontSize","getFontSize","getPixelPosition","base","rect","getBoundingClientRect","offset","scrollLeft","gutterWidth","off","cancel","hideDocTooltip","activated","relatedTarget","nodeName","href","open","activeElement","textInput","getElement","fromTooltip","tooltipNode","goTo","where","filterText","getAllRanges","remove","execCommand","deleteSuffix","gotoPageUp","gotoPageDown","gatherCompletions","getSession","createAnchor","matches","total","getCompletions","results","concat","finished","showPopup","setFilter","_id","detachIfFinished","FilteredList","cancelContextMenu","all","getDocTooltip","docText","docHTML","showDocTooltip","item","margin","pointerEvents","tabIndex","onblur","innerHTML","textContent","right","isFocused","removeChild","startCommand","bindKey","filterCompletions","sort","a","b","score","prev","filter","items","needle","upper","lower","loop","lastIndex","penalty","distance","i2","getWordIndex","textBefore","wordDistance","prefixPos","words","getValue","wordScores","Object","create","currentWord","word","idx","abs","wordScore","wordList","keys","textCompleter","keyWordCompleter","snippetCompleter","escapeHTML","setCompleters","addCompleter","onChangeMode","loadSnippetsForMode","mode","files","loadSnippetFile","modes","snippetFilePath","loadModule","doLiveAutocomplete","hasCompleter","defineOptions","enableBasicAutocompletion","set","addCommand","removeCommand","enableLiveAutocompletion","enableSnippets"],"mappings":"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","file":"ext-language_tools.js","sourcesContent":["window.ace.define(\"ace/snippets\",[\"require\",\"exports\",\"module\",\"ace/lib/oop\",\"ace/lib/event_emitter\",\"ace/lib/lang\",\"ace/range\",\"ace/anchor\",\"ace/keyboard/hash_handler\",\"ace/tokenizer\",\"ace/lib/dom\",\"ace/editor\"], function(require, exports, module) {\n\"use strict\";\nvar oop = require(\"./lib/oop\");\nvar EventEmitter = require(\"./lib/event_emitter\").EventEmitter;\nvar lang = require(\"./lib/lang\");\nvar Range = require(\"./range\").Range;\nvar Anchor = require(\"./anchor\").Anchor;\nvar HashHandler = require(\"./keyboard/hash_handler\").HashHandler;\nvar Tokenizer = require(\"./tokenizer\").Tokenizer;\nvar comparePoints = Range.comparePoints;\n\nvar SnippetManager = function() {\n    this.snippetMap = {};\n    this.snippetNameMap = {};\n};\n\n(function() {\n    oop.implement(this, EventEmitter);\n    \n    this.getTokenizer = function() {\n        function TabstopToken(str, _, stack) {\n            str = str.substr(1);\n            if (/^\\d+$/.test(str) && !stack.inFormatString)\n                return [{tabstopId: parseInt(str, 10)}];\n            return [{text: str}];\n        }\n        function escape(ch) {\n            return \"(?:[^\\\\\\\\\" + ch + \"]|\\\\\\\\.)\";\n        }\n        SnippetManager.$tokenizer = new Tokenizer({\n            start: [\n                {regex: /:/, onMatch: function(val, state, stack) {\n                    if (stack.length && stack[0].expectIf) {\n                        stack[0].expectIf = false;\n                        stack[0].elseBranch = stack[0];\n                        return [stack[0]];\n                    }\n                    return \":\";\n                }},\n                {regex: /\\\\./, onMatch: function(val, state, stack) {\n                    var ch = val[1];\n                    if (ch == \"}\" && stack.length) {\n                        val = ch;\n                    }else if (\"`$\\\\\".indexOf(ch) != -1) {\n                        val = ch;\n                    } else if (stack.inFormatString) {\n                        if (ch == \"n\")\n                            val = \"\\n\";\n                        else if (ch == \"t\")\n                            val = \"\\n\";\n                        else if (\"ulULE\".indexOf(ch) != -1) {\n                            val = {changeCase: ch, local: ch > \"a\"};\n                        }\n                    }\n\n                    return [val];\n                }},\n                {regex: /}/, onMatch: function(val, state, stack) {\n                    return [stack.length ? stack.shift() : val];\n                }},\n                {regex: /\\$(?:\\d+|\\w+)/, onMatch: TabstopToken},\n                {regex: /\\$\\{[\\dA-Z_a-z]+/, onMatch: function(str, state, stack) {\n                    var t = TabstopToken(str.substr(1), state, stack);\n                    stack.unshift(t[0]);\n                    return t;\n                }, next: \"snippetVar\"},\n                {regex: /\\n/, token: \"newline\", merge: false}\n            ],\n            snippetVar: [\n                {regex: \"\\\\|\" + escape(\"\\\\|\") + \"*\\\\|\", onMatch: function(val, state, stack) {\n                    stack[0].choices = val.slice(1, -1).split(\",\");\n                }, next: \"start\"},\n                {regex: \"/(\" + escape(\"/\") + \"+)/(?:(\" + escape(\"/\") + \"*)/)(\\\\w*):?\",\n                 onMatch: function(val, state, stack) {\n                    var ts = stack[0];\n                    ts.fmtString = val;\n\n                    val = this.splitRegex.exec(val);\n                    ts.guard = val[1];\n                    ts.fmt = val[2];\n                    ts.flag = val[3];\n                    return \"\";\n                }, next: \"start\"},\n                {regex: \"`\" + escape(\"`\") + \"*`\", onMatch: function(val, state, stack) {\n                    stack[0].code = val.splice(1, -1);\n                    return \"\";\n                }, next: \"start\"},\n                {regex: \"\\\\?\", onMatch: function(val, state, stack) {\n                    if (stack[0])\n                        stack[0].expectIf = true;\n                }, next: \"start\"},\n                {regex: \"([^:}\\\\\\\\]|\\\\\\\\.)*:?\", token: \"\", next: \"start\"}\n            ],\n            formatString: [\n                {regex: \"/(\" + escape(\"/\") + \"+)/\", token: \"regex\"},\n                {regex: \"\", onMatch: function(val, state, stack) {\n                    stack.inFormatString = true;\n                }, next: \"start\"}\n            ]\n        });\n        SnippetManager.prototype.getTokenizer = function() {\n            return SnippetManager.$tokenizer;\n        };\n        return SnippetManager.$tokenizer;\n    };\n\n    this.tokenizeTmSnippet = function(str, startState) {\n        return this.getTokenizer().getLineTokens(str, startState).tokens.map(function(x) {\n            return x.value || x;\n        });\n    };\n\n    this.$getDefaultValue = function(editor, name) {\n        if (/^[A-Z]\\d+$/.test(name)) {\n            var i = name.substr(1);\n            return (this.variables[name[0] + \"__\"] || {})[i];\n        }\n        if (/^\\d+$/.test(name)) {\n            return (this.variables.__ || {})[name];\n        }\n        name = name.replace(/^TM_/, \"\");\n\n        if (!editor)\n            return;\n        var s = editor.session;\n        switch(name) {\n            case \"CURRENT_WORD\":\n                var r = s.getWordRange();\n            case \"SELECTION\":\n            case \"SELECTED_TEXT\":\n                return s.getTextRange(r);\n            case \"CURRENT_LINE\":\n                return s.getLine(editor.getCursorPosition().row);\n            case \"PREV_LINE\": // not possible in textmate\n                return s.getLine(editor.getCursorPosition().row - 1);\n            case \"LINE_INDEX\":\n                return editor.getCursorPosition().column;\n            case \"LINE_NUMBER\":\n                return editor.getCursorPosition().row + 1;\n            case \"SOFT_TABS\":\n                return s.getUseSoftTabs() ? \"YES\" : \"NO\";\n            case \"TAB_SIZE\":\n                return s.getTabSize();\n            case \"FILENAME\":\n            case \"FILEPATH\":\n                return \"\";\n            case \"FULLNAME\":\n                return \"Ace\";\n        }\n    };\n    this.variables = {};\n    this.getVariableValue = function(editor, varName) {\n        if (this.variables.hasOwnProperty(varName))\n            return this.variables[varName](editor, varName) || \"\";\n        return this.$getDefaultValue(editor, varName) || \"\";\n    };\n    this.tmStrFormat = function(str, ch, editor) {\n        var flag = ch.flag || \"\";\n        var re = ch.guard;\n        re = new RegExp(re, flag.replace(/[^gi]/, \"\"));\n        var fmtTokens = this.tokenizeTmSnippet(ch.fmt, \"formatString\");\n        var _self = this;\n        var formatted = str.replace(re, function() {\n            _self.variables.__ = arguments;\n            var fmtParts = _self.resolveVariables(fmtTokens, editor);\n            var gChangeCase = \"E\";\n            for (var i  = 0; i < fmtParts.length; i++) {\n                var ch = fmtParts[i];\n                if (typeof ch == \"object\") {\n                    fmtParts[i] = \"\";\n                    if (ch.changeCase && ch.local) {\n                        var next = fmtParts[i + 1];\n                        if (next && typeof next == \"string\") {\n                            if (ch.changeCase == \"u\")\n                                fmtParts[i] = next[0].toUpperCase();\n                            else\n                                fmtParts[i] = next[0].toLowerCase();\n                            fmtParts[i + 1] = next.substr(1);\n                        }\n                    } else if (ch.changeCase) {\n                        gChangeCase = ch.changeCase;\n                    }\n                } else if (gChangeCase == \"U\") {\n                    fmtParts[i] = ch.toUpperCase();\n                } else if (gChangeCase == \"L\") {\n                    fmtParts[i] = ch.toLowerCase();\n                }\n            }\n            return fmtParts.join(\"\");\n        });\n        this.variables.__ = null;\n        return formatted;\n    };\n\n    this.resolveVariables = function(snippet, editor) {\n        var result = [];\n        for (var i = 0; i < snippet.length; i++) {\n            var ch = snippet[i];\n            if (typeof ch == \"string\") {\n                result.push(ch);\n            } else if (typeof ch != \"object\") {\n                continue;\n            } else if (ch.skip) {\n                gotoNext(ch);\n            } else if (ch.processed < i) {\n                continue;\n            } else if (ch.text) {\n                var value = this.getVariableValue(editor, ch.text);\n                if (value && ch.fmtString)\n                    value = this.tmStrFormat(value, ch);\n                ch.processed = i;\n                if (ch.expectIf == null) {\n                    if (value) {\n                        result.push(value);\n                        gotoNext(ch);\n                    }\n                } else {\n                    if (value) {\n                        ch.skip = ch.elseBranch;\n                    } else\n                        gotoNext(ch);\n                }\n            } else if (ch.tabstopId != null) {\n                result.push(ch);\n            } else if (ch.changeCase != null) {\n                result.push(ch);\n            }\n        }\n        function gotoNext(ch) {\n            var i1 = snippet.indexOf(ch, i + 1);\n            if (i1 != -1)\n                i = i1;\n        }\n        return result;\n    };\n\n    this.insertSnippetForSelection = function(editor, snippetText) {\n        var cursor = editor.getCursorPosition();\n        var line = editor.session.getLine(cursor.row);\n        var tabString = editor.session.getTabString();\n        var indentString = line.match(/^\\s*/)[0];\n        \n        if (cursor.column < indentString.length)\n            indentString = indentString.slice(0, cursor.column);\n\n        snippetText = snippetText.replace(/\\r/g, \"\");\n        var tokens = this.tokenizeTmSnippet(snippetText);\n        tokens = this.resolveVariables(tokens, editor);\n        tokens = tokens.map(function(x) {\n            if (x == \"\\n\")\n                return x + indentString;\n            if (typeof x == \"string\")\n                return x.replace(/\\t/g, tabString);\n            return x;\n        });\n        var tabstops = [];\n        tokens.forEach(function(p, i) {\n            if (typeof p != \"object\")\n                return;\n            var id = p.tabstopId;\n            var ts = tabstops[id];\n            if (!ts) {\n                ts = tabstops[id] = [];\n                ts.index = id;\n                ts.value = \"\";\n            }\n            if (ts.indexOf(p) !== -1)\n                return;\n            ts.push(p);\n            var i1 = tokens.indexOf(p, i + 1);\n            if (i1 === -1)\n                return;\n\n            var value = tokens.slice(i + 1, i1);\n            var isNested = value.some(function(t) {return typeof t === \"object\"});          \n            if (isNested && !ts.value) {\n                ts.value = value;\n            } else if (value.length && (!ts.value || typeof ts.value !== \"string\")) {\n                ts.value = value.join(\"\");\n            }\n        });\n        tabstops.forEach(function(ts) {ts.length = 0});\n        var expanding = {};\n        function copyValue(val) {\n            var copy = [];\n            for (var i = 0; i < val.length; i++) {\n                var p = val[i];\n                if (typeof p == \"object\") {\n                    if (expanding[p.tabstopId])\n                        continue;\n                    var j = val.lastIndexOf(p, i - 1);\n                    p = copy[j] || {tabstopId: p.tabstopId};\n                }\n                copy[i] = p;\n            }\n            return copy;\n        }\n        for (var i = 0; i < tokens.length; i++) {\n            var p = tokens[i];\n            if (typeof p != \"object\")\n                continue;\n            var id = p.tabstopId;\n            var i1 = tokens.indexOf(p, i + 1);\n            if (expanding[id]) {\n                if (expanding[id] === p)\n                    expanding[id] = null;\n                continue;\n            }\n            \n            var ts = tabstops[id];\n            var arg = typeof ts.value == \"string\" ? [ts.value] : copyValue(ts.value);\n            arg.unshift(i + 1, Math.max(0, i1 - i));\n            arg.push(p);\n            expanding[id] = p;\n            tokens.splice.apply(tokens, arg);\n\n            if (ts.indexOf(p) === -1)\n                ts.push(p);\n        }\n        var row = 0, column = 0;\n        var text = \"\";\n        tokens.forEach(function(t) {\n            if (typeof t === \"string\") {\n                var lines = t.split(\"\\n\");\n                if (lines.length > 1){\n                    column = lines[lines.length - 1].length;\n                    row += lines.length - 1;\n                } else\n                    column += t.length;\n                text += t;\n            } else {\n                if (!t.start)\n                    t.start = {row: row, column: column};\n                else\n                    t.end = {row: row, column: column};\n            }\n        });\n        var range = editor.getSelectionRange();\n        var end = editor.session.replace(range, text);\n\n        var tabstopManager = new TabstopManager(editor);\n        var selectionId = editor.inVirtualSelectionMode && editor.selection.index;\n        tabstopManager.addTabstops(tabstops, range.start, end, selectionId);\n    };\n    \n    this.insertSnippet = function(editor, snippetText) {\n        var self = this;\n        if (editor.inVirtualSelectionMode)\n            return self.insertSnippetForSelection(editor, snippetText);\n        \n        editor.forEachSelection(function() {\n            self.insertSnippetForSelection(editor, snippetText);\n        }, null, {keepOrder: true});\n        \n        if (editor.tabstopManager)\n            editor.tabstopManager.tabNext();\n    };\n\n    this.$getScope = function(editor) {\n        var scope = editor.session.$mode.$id || \"\";\n        scope = scope.split(\"/\").pop();\n        if (scope === \"html\" || scope === \"php\") {\n            if (scope === \"php\" && !editor.session.$mode.inlinePhp) \n                scope = \"html\";\n            var c = editor.getCursorPosition();\n            var state = editor.session.getState(c.row);\n            if (typeof state === \"object\") {\n                state = state[0];\n            }\n            if (state.substring) {\n                if (state.substring(0, 3) == \"js-\")\n                    scope = \"javascript\";\n                else if (state.substring(0, 4) == \"css-\")\n                    scope = \"css\";\n                else if (state.substring(0, 4) == \"php-\")\n                    scope = \"php\";\n            }\n        }\n        \n        return scope;\n    };\n\n    this.getActiveScopes = function(editor) {\n        var scope = this.$getScope(editor);\n        var scopes = [scope];\n        var snippetMap = this.snippetMap;\n        if (snippetMap[scope] && snippetMap[scope].includeScopes) {\n            scopes.push.apply(scopes, snippetMap[scope].includeScopes);\n        }\n        scopes.push(\"_\");\n        return scopes;\n    };\n\n    this.expandWithTab = function(editor, options) {\n        var self = this;\n        var result = editor.forEachSelection(function() {\n            return self.expandSnippetForSelection(editor, options);\n        }, null, {keepOrder: true});\n        if (result && editor.tabstopManager)\n            editor.tabstopManager.tabNext();\n        return result;\n    };\n    \n    this.expandSnippetForSelection = function(editor, options) {\n        var cursor = editor.getCursorPosition();\n        var line = editor.session.getLine(cursor.row);\n        var before = line.substring(0, cursor.column);\n        var after = line.substr(cursor.column);\n\n        var snippetMap = this.snippetMap;\n        var snippet;\n        this.getActiveScopes(editor).some(function(scope) {\n            var snippets = snippetMap[scope];\n            if (snippets)\n                snippet = this.findMatchingSnippet(snippets, before, after);\n            return !!snippet;\n        }, this);\n        if (!snippet)\n            return false;\n        if (options && options.dryRun)\n            return true;\n        editor.session.doc.removeInLine(cursor.row,\n            cursor.column - snippet.replaceBefore.length,\n            cursor.column + snippet.replaceAfter.length\n        );\n\n        this.variables.M__ = snippet.matchBefore;\n        this.variables.T__ = snippet.matchAfter;\n        this.insertSnippetForSelection(editor, snippet.content);\n\n        this.variables.M__ = this.variables.T__ = null;\n        return true;\n    };\n\n    this.findMatchingSnippet = function(snippetList, before, after) {\n        for (var i = snippetList.length; i--;) {\n            var s = snippetList[i];\n            if (s.startRe && !s.startRe.test(before))\n                continue;\n            if (s.endRe && !s.endRe.test(after))\n                continue;\n            if (!s.startRe && !s.endRe)\n                continue;\n\n            s.matchBefore = s.startRe ? s.startRe.exec(before) : [\"\"];\n            s.matchAfter = s.endRe ? s.endRe.exec(after) : [\"\"];\n            s.replaceBefore = s.triggerRe ? s.triggerRe.exec(before)[0] : \"\";\n            s.replaceAfter = s.endTriggerRe ? s.endTriggerRe.exec(after)[0] : \"\";\n            return s;\n        }\n    };\n\n    this.snippetMap = {};\n    this.snippetNameMap = {};\n    this.register = function(snippets, scope) {\n        var snippetMap = this.snippetMap;\n        var snippetNameMap = this.snippetNameMap;\n        var self = this;\n        \n        if (!snippets) \n            snippets = [];\n        \n        function wrapRegexp(src) {\n            if (src && !/^\\^?\\(.*\\)\\$?$|^\\\\b$/.test(src))\n                src = \"(?:\" + src + \")\";\n\n            return src || \"\";\n        }\n        function guardedRegexp(re, guard, opening) {\n            re = wrapRegexp(re);\n            guard = wrapRegexp(guard);\n            if (opening) {\n                re = guard + re;\n                if (re && re[re.length - 1] != \"$\")\n                    re = re + \"$\";\n            } else {\n                re = re + guard;\n                if (re && re[0] != \"^\")\n                    re = \"^\" + re;\n            }\n            return new RegExp(re);\n        }\n\n        function addSnippet(s) {\n            if (!s.scope)\n                s.scope = scope || \"_\";\n            scope = s.scope;\n            if (!snippetMap[scope]) {\n                snippetMap[scope] = [];\n                snippetNameMap[scope] = {};\n            }\n\n            var map = snippetNameMap[scope];\n            if (s.name) {\n                var old = map[s.name];\n                if (old)\n                    self.unregister(old);\n                map[s.name] = s;\n            }\n            snippetMap[scope].push(s);\n\n            if (s.tabTrigger && !s.trigger) {\n                if (!s.guard && /^\\w/.test(s.tabTrigger))\n                    s.guard = \"\\\\b\";\n                s.trigger = lang.escapeRegExp(s.tabTrigger);\n            }\n            \n            if (!s.trigger && !s.guard && !s.endTrigger && !s.endGuard)\n                return;\n            \n            s.startRe = guardedRegexp(s.trigger, s.guard, true);\n            s.triggerRe = new RegExp(s.trigger, \"\", true);\n\n            s.endRe = guardedRegexp(s.endTrigger, s.endGuard, true);\n            s.endTriggerRe = new RegExp(s.endTrigger, \"\", true);\n        }\n\n        if (snippets && snippets.content)\n            addSnippet(snippets);\n        else if (Array.isArray(snippets))\n            snippets.forEach(addSnippet);\n        \n        this._signal(\"registerSnippets\", {scope: scope});\n    };\n    this.unregister = function(snippets, scope) {\n        var snippetMap = this.snippetMap;\n        var snippetNameMap = this.snippetNameMap;\n\n        function removeSnippet(s) {\n            var nameMap = snippetNameMap[s.scope||scope];\n            if (nameMap && nameMap[s.name]) {\n                delete nameMap[s.name];\n                var map = snippetMap[s.scope||scope];\n                var i = map && map.indexOf(s);\n                if (i >= 0)\n                    map.splice(i, 1);\n            }\n        }\n        if (snippets.content)\n            removeSnippet(snippets);\n        else if (Array.isArray(snippets))\n            snippets.forEach(removeSnippet);\n    };\n    this.parseSnippetFile = function(str) {\n        str = str.replace(/\\r/g, \"\");\n        var list = [], snippet = {};\n        var re = /^#.*|^({[\\s\\S]*})\\s*$|^(\\S+) (.*)$|^((?:\\n*\\t.*)+)/gm;\n        var m;\n        while (m = re.exec(str)) {\n            if (m[1]) {\n                try {\n                    snippet = JSON.parse(m[1]);\n                    list.push(snippet);\n                } catch (e) {}\n            } if (m[4]) {\n                snippet.content = m[4].replace(/^\\t/gm, \"\");\n                list.push(snippet);\n                snippet = {};\n            } else {\n                var key = m[2], val = m[3];\n                if (key == \"regex\") {\n                    var guardRe = /\\/((?:[^\\/\\\\]|\\\\.)*)|$/g;\n                    snippet.guard = guardRe.exec(val)[1];\n                    snippet.trigger = guardRe.exec(val)[1];\n                    snippet.endTrigger = guardRe.exec(val)[1];\n                    snippet.endGuard = guardRe.exec(val)[1];\n                } else if (key == \"snippet\") {\n                    snippet.tabTrigger = val.match(/^\\S*/)[0];\n                    if (!snippet.name)\n                        snippet.name = val;\n                } else {\n                    snippet[key] = val;\n                }\n            }\n        }\n        return list;\n    };\n    this.getSnippetByName = function(name, editor) {\n        var snippetMap = this.snippetNameMap;\n        var snippet;\n        this.getActiveScopes(editor).some(function(scope) {\n            var snippets = snippetMap[scope];\n            if (snippets)\n                snippet = snippets[name];\n            return !!snippet;\n        }, this);\n        return snippet;\n    };\n\n}).call(SnippetManager.prototype);\n\n\nvar TabstopManager = function(editor) {\n    if (editor.tabstopManager)\n        return editor.tabstopManager;\n    editor.tabstopManager = this;\n    this.$onChange = this.onChange.bind(this);\n    this.$onChangeSelection = lang.delayedCall(this.onChangeSelection.bind(this)).schedule;\n    this.$onChangeSession = this.onChangeSession.bind(this);\n    this.$onAfterExec = this.onAfterExec.bind(this);\n    this.attach(editor);\n};\n(function() {\n    this.attach = function(editor) {\n        this.index = 0;\n        this.ranges = [];\n        this.tabstops = [];\n        this.$openTabstops = null;\n        this.selectedTabstop = null;\n\n        this.editor = editor;\n        this.editor.on(\"change\", this.$onChange);\n        this.editor.on(\"changeSelection\", this.$onChangeSelection);\n        this.editor.on(\"changeSession\", this.$onChangeSession);\n        this.editor.commands.on(\"afterExec\", this.$onAfterExec);\n        this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\n    };\n    this.detach = function() {\n        this.tabstops.forEach(this.removeTabstopMarkers, this);\n        this.ranges = null;\n        this.tabstops = null;\n        this.selectedTabstop = null;\n        this.editor.removeListener(\"change\", this.$onChange);\n        this.editor.removeListener(\"changeSelection\", this.$onChangeSelection);\n        this.editor.removeListener(\"changeSession\", this.$onChangeSession);\n        this.editor.commands.removeListener(\"afterExec\", this.$onAfterExec);\n        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);\n        this.editor.tabstopManager = null;\n        this.editor = null;\n    };\n\n    this.onChange = function(delta) {\n        var changeRange = delta;\n        var isRemove = delta.action[0] == \"r\";\n        var start = delta.start;\n        var end = delta.end;\n        var startRow = start.row;\n        var endRow = end.row;\n        var lineDif = endRow - startRow;\n        var colDiff = end.column - start.column;\n\n        if (isRemove) {\n            lineDif = -lineDif;\n            colDiff = -colDiff;\n        }\n        if (!this.$inChange && isRemove) {\n            var ts = this.selectedTabstop;\n            var changedOutside = ts && !ts.some(function(r) {\n                return comparePoints(r.start, start) <= 0 && comparePoints(r.end, end) >= 0;\n            });\n            if (changedOutside)\n                return this.detach();\n        }\n        var ranges = this.ranges;\n        for (var i = 0; i < ranges.length; i++) {\n            var r = ranges[i];\n            if (r.end.row < start.row)\n                continue;\n\n            if (isRemove && comparePoints(start, r.start) < 0 && comparePoints(end, r.end) > 0) {\n                this.removeRange(r);\n                i--;\n                continue;\n            }\n\n            if (r.start.row == startRow && r.start.column > start.column)\n                r.start.column += colDiff;\n            if (r.end.row == startRow && r.end.column >= start.column)\n                r.end.column += colDiff;\n            if (r.start.row >= startRow)\n                r.start.row += lineDif;\n            if (r.end.row >= startRow)\n                r.end.row += lineDif;\n\n            if (comparePoints(r.start, r.end) > 0)\n                this.removeRange(r);\n        }\n        if (!ranges.length)\n            this.detach();\n    };\n    this.updateLinkedFields = function() {\n        var ts = this.selectedTabstop;\n        if (!ts || !ts.hasLinkedRanges)\n            return;\n        this.$inChange = true;\n        var session = this.editor.session;\n        var text = session.getTextRange(ts.firstNonLinked);\n        for (var i = ts.length; i--;) {\n            var range = ts[i];\n            if (!range.linked)\n                continue;\n            var fmt = exports.snippetManager.tmStrFormat(text, range.original);\n            session.replace(range, fmt);\n        }\n        this.$inChange = false;\n    };\n    this.onAfterExec = function(e) {\n        if (e.command && !e.command.readOnly)\n            this.updateLinkedFields();\n    };\n    this.onChangeSelection = function() {\n        if (!this.editor)\n            return;\n        var lead = this.editor.selection.lead;\n        var anchor = this.editor.selection.anchor;\n        var isEmpty = this.editor.selection.isEmpty();\n        for (var i = this.ranges.length; i--;) {\n            if (this.ranges[i].linked)\n                continue;\n            var containsLead = this.ranges[i].contains(lead.row, lead.column);\n            var containsAnchor = isEmpty || this.ranges[i].contains(anchor.row, anchor.column);\n            if (containsLead && containsAnchor)\n                return;\n        }\n        this.detach();\n    };\n    this.onChangeSession = function() {\n        this.detach();\n    };\n    this.tabNext = function(dir) {\n        var max = this.tabstops.length;\n        var index = this.index + (dir || 1);\n        index = Math.min(Math.max(index, 1), max);\n        if (index == max)\n            index = 0;\n        this.selectTabstop(index);\n        if (index === 0)\n            this.detach();\n    };\n    this.selectTabstop = function(index) {\n        this.$openTabstops = null;\n        var ts = this.tabstops[this.index];\n        if (ts)\n            this.addTabstopMarkers(ts);\n        this.index = index;\n        ts = this.tabstops[this.index];\n        if (!ts || !ts.length)\n            return;\n        \n        this.selectedTabstop = ts;\n        if (!this.editor.inVirtualSelectionMode) {        \n            var sel = this.editor.multiSelect;\n            sel.toSingleRange(ts.firstNonLinked.clone());\n            for (var i = ts.length; i--;) {\n                if (ts.hasLinkedRanges && ts[i].linked)\n                    continue;\n                sel.addRange(ts[i].clone(), true);\n            }\n            if (sel.ranges[0])\n                sel.addRange(sel.ranges[0].clone());\n        } else {\n            this.editor.selection.setRange(ts.firstNonLinked);\n        }\n        \n        this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\n    };\n    this.addTabstops = function(tabstops, start, end) {\n        if (!this.$openTabstops)\n            this.$openTabstops = [];\n        if (!tabstops[0]) {\n            var p = Range.fromPoints(end, end);\n            moveRelative(p.start, start);\n            moveRelative(p.end, start);\n            tabstops[0] = [p];\n            tabstops[0].index = 0;\n        }\n\n        var i = this.index;\n        var arg = [i + 1, 0];\n        var ranges = this.ranges;\n        tabstops.forEach(function(ts, index) {\n            var dest = this.$openTabstops[index] || ts;\n                \n            for (var i = ts.length; i--;) {\n                var p = ts[i];\n                var range = Range.fromPoints(p.start, p.end || p.start);\n                movePoint(range.start, start);\n                movePoint(range.end, start);\n                range.original = p;\n                range.tabstop = dest;\n                ranges.push(range);\n                if (dest != ts)\n                    dest.unshift(range);\n                else\n                    dest[i] = range;\n                if (p.fmtString) {\n                    range.linked = true;\n                    dest.hasLinkedRanges = true;\n                } else if (!dest.firstNonLinked)\n                    dest.firstNonLinked = range;\n            }\n            if (!dest.firstNonLinked)\n                dest.hasLinkedRanges = false;\n            if (dest === ts) {\n                arg.push(dest);\n                this.$openTabstops[index] = dest;\n            }\n            this.addTabstopMarkers(dest);\n        }, this);\n        \n        if (arg.length > 2) {\n            if (this.tabstops.length)\n                arg.push(arg.splice(2, 1)[0]);\n            this.tabstops.splice.apply(this.tabstops, arg);\n        }\n    };\n\n    this.addTabstopMarkers = function(ts) {\n        var session = this.editor.session;\n        ts.forEach(function(range) {\n            if  (!range.markerId)\n                range.markerId = session.addMarker(range, \"ace_snippet-marker\", \"text\");\n        });\n    };\n    this.removeTabstopMarkers = function(ts) {\n        var session = this.editor.session;\n        ts.forEach(function(range) {\n            session.removeMarker(range.markerId);\n            range.markerId = null;\n        });\n    };\n    this.removeRange = function(range) {\n        var i = range.tabstop.indexOf(range);\n        range.tabstop.splice(i, 1);\n        i = this.ranges.indexOf(range);\n        this.ranges.splice(i, 1);\n        this.editor.session.removeMarker(range.markerId);\n        if (!range.tabstop.length) {\n            i = this.tabstops.indexOf(range.tabstop);\n            if (i != -1)\n                this.tabstops.splice(i, 1);\n            if (!this.tabstops.length)\n                this.detach();\n        }\n    };\n\n    this.keyboardHandler = new HashHandler();\n    this.keyboardHandler.bindKeys({\n        \"Tab\": function(ed) {\n            if (exports.snippetManager && exports.snippetManager.expandWithTab(ed)) {\n                return;\n            }\n\n            ed.tabstopManager.tabNext(1);\n        },\n        \"Shift-Tab\": function(ed) {\n            ed.tabstopManager.tabNext(-1);\n        },\n        \"Esc\": function(ed) {\n            ed.tabstopManager.detach();\n        },\n        \"Return\": function(ed) {\n            return false;\n        }\n    });\n}).call(TabstopManager.prototype);\n\n\n\nvar changeTracker = {};\nchangeTracker.onChange = Anchor.prototype.onChange;\nchangeTracker.setPosition = function(row, column) {\n    this.pos.row = row;\n    this.pos.column = column;\n};\nchangeTracker.update = function(pos, delta, $insertRight) {\n    this.$insertRight = $insertRight;\n    this.pos = pos; \n    this.onChange(delta);\n};\n\nvar movePoint = function(point, diff) {\n    if (point.row == 0)\n        point.column += diff.column;\n    point.row += diff.row;\n};\n\nvar moveRelative = function(point, start) {\n    if (point.row == start.row)\n        point.column -= start.column;\n    point.row -= start.row;\n};\n\n\nrequire(\"./lib/dom\").importCssString(\"\\\n.ace_snippet-marker {\\\n    -moz-box-sizing: border-box;\\\n    box-sizing: border-box;\\\n    background: rgba(194, 193, 208, 0.09);\\\n    border: 1px dotted rgba(211, 208, 235, 0.62);\\\n    position: absolute;\\\n}\");\n\nexports.snippetManager = new SnippetManager();\n\n\nvar Editor = require(\"./editor\").Editor;\n(function() {\n    this.insertSnippet = function(content, options) {\n        return exports.snippetManager.insertSnippet(this, content, options);\n    };\n    this.expandSnippet = function(options) {\n        return exports.snippetManager.expandWithTab(this, options);\n    };\n}).call(Editor.prototype);\n\n});\n\ndefine(\"ace/autocomplete/popup\",[\"require\",\"exports\",\"module\",\"ace/virtual_renderer\",\"ace/editor\",\"ace/range\",\"ace/lib/event\",\"ace/lib/lang\",\"ace/lib/dom\"], function(require, exports, module) {\n\"use strict\";\n\nvar Renderer = require(\"../virtual_renderer\").VirtualRenderer;\nvar Editor = require(\"../editor\").Editor;\nvar Range = require(\"../range\").Range;\nvar event = require(\"../lib/event\");\nvar lang = require(\"../lib/lang\");\nvar dom = require(\"../lib/dom\");\n\nvar $singleLineEditor = function(el) {\n    var renderer = new Renderer(el);\n\n    renderer.$maxLines = 4;\n\n    var editor = new Editor(renderer);\n\n    editor.setHighlightActiveLine(false);\n    editor.setShowPrintMargin(false);\n    editor.renderer.setShowGutter(false);\n    editor.renderer.setHighlightGutterLine(false);\n\n    editor.$mouseHandler.$focusWaitTimout = 0;\n    editor.$highlightTagPending = true;\n\n    return editor;\n};\n\nvar AcePopup = function(parentNode) {\n    var el = dom.createElement(\"div\");\n    var popup = new $singleLineEditor(el);\n\n    if (parentNode)\n        parentNode.appendChild(el);\n    el.style.display = \"none\";\n    popup.renderer.content.style.cursor = \"default\";\n    popup.renderer.setStyle(\"ace_autocomplete\");\n\n    popup.setOption(\"displayIndentGuides\", false);\n    popup.setOption(\"dragDelay\", 150);\n\n    var noop = function(){};\n\n    popup.focus = noop;\n    popup.$isFocused = true;\n\n    popup.renderer.$cursorLayer.restartTimer = noop;\n    popup.renderer.$cursorLayer.element.style.opacity = 0;\n\n    popup.renderer.$maxLines = 8;\n    popup.renderer.$keepTextAreaAtCursor = false;\n\n    popup.setHighlightActiveLine(false);\n    popup.session.highlight(\"\");\n    popup.session.$searchHighlight.clazz = \"ace_highlight-marker\";\n\n    popup.on(\"mousedown\", function(e) {\n        var pos = e.getDocumentPosition();\n        popup.selection.moveToPosition(pos);\n        selectionMarker.start.row = selectionMarker.end.row = pos.row;\n        e.stop();\n    });\n\n    var lastMouseEvent;\n    var hoverMarker = new Range(-1,0,-1,Infinity);\n    var selectionMarker = new Range(-1,0,-1,Infinity);\n    selectionMarker.id = popup.session.addMarker(selectionMarker, \"ace_active-line\", \"fullLine\");\n    popup.setSelectOnHover = function(val) {\n        if (!val) {\n            hoverMarker.id = popup.session.addMarker(hoverMarker, \"ace_line-hover\", \"fullLine\");\n        } else if (hoverMarker.id) {\n            popup.session.removeMarker(hoverMarker.id);\n            hoverMarker.id = null;\n        }\n    };\n    popup.setSelectOnHover(false);\n    popup.on(\"mousemove\", function(e) {\n        if (!lastMouseEvent) {\n            lastMouseEvent = e;\n            return;\n        }\n        if (lastMouseEvent.x == e.x && lastMouseEvent.y == e.y) {\n            return;\n        }\n        lastMouseEvent = e;\n        lastMouseEvent.scrollTop = popup.renderer.scrollTop;\n        var row = lastMouseEvent.getDocumentPosition().row;\n        if (hoverMarker.start.row != row) {\n            if (!hoverMarker.id)\n                popup.setRow(row);\n            setHoverMarker(row);\n        }\n    });\n    popup.renderer.on(\"beforeRender\", function() {\n        if (lastMouseEvent && hoverMarker.start.row != -1) {\n            lastMouseEvent.$pos = null;\n            var row = lastMouseEvent.getDocumentPosition().row;\n            if (!hoverMarker.id)\n                popup.setRow(row);\n            setHoverMarker(row, true);\n        }\n    });\n    popup.renderer.on(\"afterRender\", function() {\n        var row = popup.getRow();\n        var t = popup.renderer.$textLayer;\n        var selected = t.element.childNodes[row - t.config.firstRow];\n        if (selected == t.selectedNode)\n            return;\n        if (t.selectedNode)\n            dom.removeCssClass(t.selectedNode, \"ace_selected\");\n        t.selectedNode = selected;\n        if (selected)\n            dom.addCssClass(selected, \"ace_selected\");\n    });\n    var hideHoverMarker = function() { setHoverMarker(-1) };\n    var setHoverMarker = function(row, suppressRedraw) {\n        if (row !== hoverMarker.start.row) {\n            hoverMarker.start.row = hoverMarker.end.row = row;\n            if (!suppressRedraw)\n                popup.session._emit(\"changeBackMarker\");\n            popup._emit(\"changeHoverMarker\");\n        }\n    };\n    popup.getHoveredRow = function() {\n        return hoverMarker.start.row;\n    };\n\n    event.addListener(popup.container, \"mouseout\", hideHoverMarker);\n    popup.on(\"hide\", hideHoverMarker);\n    popup.on(\"changeSelection\", hideHoverMarker);\n\n    popup.session.doc.getLength = function() {\n        return popup.data.length;\n    };\n    popup.session.doc.getLine = function(i) {\n        var data = popup.data[i];\n        if (typeof data == \"string\")\n            return data;\n        return (data && data.value) || \"\";\n    };\n\n    var bgTokenizer = popup.session.bgTokenizer;\n    bgTokenizer.$tokenizeRow = function(row) {\n        var data = popup.data[row];\n        var tokens = [];\n        if (!data)\n            return tokens;\n        if (typeof data == \"string\")\n            data = {value: data};\n        if (!data.caption)\n            data.caption = data.value || data.name;\n\n        var last = -1;\n        var flag, c;\n        for (var i = 0; i < data.caption.length; i++) {\n            c = data.caption[i];\n            flag = data.matchMask & (1 << i) ? 1 : 0;\n            if (last !== flag) {\n                tokens.push({type: data.className || \"\" + ( flag ? \"completion-highlight\" : \"\"), value: c});\n                last = flag;\n            } else {\n                tokens[tokens.length - 1].value += c;\n            }\n        }\n\n        if (data.meta) {\n            var maxW = popup.renderer.$size.scrollerWidth / popup.renderer.layerConfig.characterWidth;\n            var metaData = data.meta;\n            if (metaData.length + data.caption.length > maxW - 2) {\n                metaData = metaData.substr(0, maxW - data.caption.length - 3) + \"\\u2026\"\n            }\n            tokens.push({type: \"rightAlignedText\", value: metaData});\n        }\n        return tokens;\n    };\n    bgTokenizer.$updateOnChange = noop;\n    bgTokenizer.start = noop;\n\n    popup.session.$computeWidth = function() {\n        return this.screenWidth = 0;\n    };\n\n    popup.$blockScrolling = Infinity;\n    popup.isOpen = false;\n    popup.isTopdown = false;\n\n    popup.data = [];\n    popup.setData = function(list) {\n        popup.setValue(lang.stringRepeat(\"\\n\", list.length), -1);\n        popup.data = list || [];\n        popup.setRow(0);\n    };\n    popup.getData = function(row) {\n        return popup.data[row];\n    };\n\n    popup.getRow = function() {\n        return selectionMarker.start.row;\n    };\n    popup.setRow = function(line) {\n        line = Math.max(0, Math.min(this.data.length, line));\n        if (selectionMarker.start.row != line) {\n            popup.selection.clearSelection();\n            selectionMarker.start.row = selectionMarker.end.row = line || 0;\n            popup.session._emit(\"changeBackMarker\");\n            popup.moveCursorTo(line || 0, 0);\n            if (popup.isOpen)\n                popup._signal(\"select\");\n        }\n    };\n\n    popup.on(\"changeSelection\", function() {\n        if (popup.isOpen)\n            popup.setRow(popup.selection.lead.row);\n        popup.renderer.scrollCursorIntoView();\n    });\n\n    popup.hide = function() {\n        this.container.style.display = \"none\";\n        this._signal(\"hide\");\n        popup.isOpen = false;\n    };\n    popup.show = function(pos, lineHeight, topdownOnly) {\n        var el = this.container;\n        var screenHeight = window.innerHeight;\n        var screenWidth = window.innerWidth;\n        var renderer = this.renderer;\n        var maxH = renderer.$maxLines * lineHeight * 1.4;\n        var top = pos.top + this.$borderSize;\n        var allowTopdown = top > screenHeight / 2 && !topdownOnly;\n        if (allowTopdown && top + lineHeight + maxH > screenHeight) {\n            renderer.$maxPixelHeight = top - 2 * this.$borderSize;\n            el.style.top = \"\";\n            el.style.bottom = screenHeight - top + \"px\";\n            popup.isTopdown = false;\n        } else {\n            top += lineHeight;\n            renderer.$maxPixelHeight = screenHeight - top - 0.2 * lineHeight;\n            el.style.top = top + \"px\";\n            el.style.bottom = \"\";\n            popup.isTopdown = true;\n        }\n\n        el.style.display = \"\";\n        this.renderer.$textLayer.checkForSizeChanges();\n\n        var left = pos.left;\n        if (left + el.offsetWidth > screenWidth)\n            left = screenWidth - el.offsetWidth;\n\n        el.style.left = left + \"px\";\n\n        this._signal(\"show\");\n        lastMouseEvent = null;\n        popup.isOpen = true;\n    };\n\n    popup.getTextLeftOffset = function() {\n        return this.$borderSize + this.renderer.$padding + this.$imageSize;\n    };\n\n    popup.$imageSize = 0;\n    popup.$borderSize = 1;\n\n    return popup;\n};\n\ndom.importCssString(\"\\\n.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\\\n    background-color: #CAD6FA;\\\n    z-index: 1;\\\n}\\\n.ace_editor.ace_autocomplete .ace_line-hover {\\\n    border: 1px solid #abbffe;\\\n    margin-top: -1px;\\\n    background: rgba(233,233,253,0.4);\\\n}\\\n.ace_editor.ace_autocomplete .ace_line-hover {\\\n    position: absolute;\\\n    z-index: 2;\\\n}\\\n.ace_editor.ace_autocomplete .ace_scroller {\\\n   background: none;\\\n   border: none;\\\n   box-shadow: none;\\\n}\\\n.ace_rightAlignedText {\\\n    color: gray;\\\n    display: inline-block;\\\n    position: absolute;\\\n    right: 4px;\\\n    text-align: right;\\\n    z-index: -1;\\\n}\\\n.ace_editor.ace_autocomplete .ace_completion-highlight{\\\n    color: #000;\\\n    text-shadow: 0 0 0.01em;\\\n}\\\n.ace_editor.ace_autocomplete {\\\n    width: 280px;\\\n    z-index: 200000;\\\n    background: #fbfbfb;\\\n    color: #444;\\\n    border: 1px lightgray solid;\\\n    position: fixed;\\\n    box-shadow: 2px 3px 5px rgba(0,0,0,.2);\\\n    line-height: 1.4;\\\n}\");\n\nexports.AcePopup = AcePopup;\n\n});\n\ndefine(\"ace/autocomplete/util\",[\"require\",\"exports\",\"module\"], function(require, exports, module) {\n\"use strict\";\n\nexports.parForEach = function(array, fn, callback) {\n    var completed = 0;\n    var arLength = array.length;\n    if (arLength === 0)\n        callback();\n    for (var i = 0; i < arLength; i++) {\n        fn(array[i], function(result, err) {\n            completed++;\n            if (completed === arLength)\n                callback(result, err);\n        });\n    }\n};\n\nvar ID_REGEX = /[a-zA-Z_0-9\\$\\-\\u00A2-\\uFFFF]/;\n\nexports.retrievePrecedingIdentifier = function(text, pos, regex) {\n    regex = regex || ID_REGEX;\n    var buf = [];\n    for (var i = pos-1; i >= 0; i--) {\n        if (regex.test(text[i]))\n            buf.push(text[i]);\n        else\n            break;\n    }\n    return buf.reverse().join(\"\");\n};\n\nexports.retrieveFollowingIdentifier = function(text, pos, regex) {\n    regex = regex || ID_REGEX;\n    var buf = [];\n    for (var i = pos; i < text.length; i++) {\n        if (regex.test(text[i]))\n            buf.push(text[i]);\n        else\n            break;\n    }\n    return buf;\n};\n\nexports.getCompletionPrefix = function (editor) {\n    var pos = editor.getCursorPosition();\n    var line = editor.session.getLine(pos.row);\n    var prefix;\n    editor.completers.forEach(function(completer) {\n        if (completer.identifierRegexps) {\n            completer.identifierRegexps.forEach(function(identifierRegex) {\n                if (!prefix && identifierRegex)\n                    prefix = this.retrievePrecedingIdentifier(line, pos.column, identifierRegex);\n            }.bind(this));\n        }\n    }.bind(this));\n    return prefix || this.retrievePrecedingIdentifier(line, pos.column);\n};\n\n});\n\ndefine(\"ace/autocomplete\",[\"require\",\"exports\",\"module\",\"ace/keyboard/hash_handler\",\"ace/autocomplete/popup\",\"ace/autocomplete/util\",\"ace/lib/event\",\"ace/lib/lang\",\"ace/lib/dom\",\"ace/snippets\"], function(require, exports, module) {\n\"use strict\";\n\nvar HashHandler = require(\"./keyboard/hash_handler\").HashHandler;\nvar AcePopup = require(\"./autocomplete/popup\").AcePopup;\nvar util = require(\"./autocomplete/util\");\nvar event = require(\"./lib/event\");\nvar lang = require(\"./lib/lang\");\nvar dom = require(\"./lib/dom\");\nvar snippetManager = require(\"./snippets\").snippetManager;\n\nvar Autocomplete = function() {\n    this.autoInsert = false;\n    this.autoSelect = true;\n    this.exactMatch = false;\n    this.gatherCompletionsId = 0;\n    this.keyboardHandler = new HashHandler();\n    this.keyboardHandler.bindKeys(this.commands);\n\n    this.blurListener = this.blurListener.bind(this);\n    this.changeListener = this.changeListener.bind(this);\n    this.mousedownListener = this.mousedownListener.bind(this);\n    this.mousewheelListener = this.mousewheelListener.bind(this);\n\n    this.changeTimer = lang.delayedCall(function() {\n        this.updateCompletions(true);\n    }.bind(this));\n\n    this.tooltipTimer = lang.delayedCall(this.updateDocTooltip.bind(this), 50);\n};\n\n(function() {\n\n    this.$init = function() {\n        this.popup = new AcePopup(document.body || document.documentElement);\n        this.popup.on(\"click\", function(e) {\n            this.insertMatch();\n            e.stop();\n        }.bind(this));\n        this.popup.focus = this.editor.focus.bind(this.editor);\n        this.popup.on(\"show\", this.tooltipTimer.bind(null, null));\n        this.popup.on(\"select\", this.tooltipTimer.bind(null, null));\n        this.popup.on(\"changeHoverMarker\", this.tooltipTimer.bind(null, null));\n        return this.popup;\n    };\n\n    this.getPopup = function() {\n        return this.popup || this.$init();\n    };\n\n    this.openPopup = function(editor, prefix, keepPopupPosition) {\n        if (!this.popup)\n            this.$init();\n\n        this.popup.setData(this.completions.filtered);\n\n        editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\n        \n        var renderer = editor.renderer;\n        this.popup.setRow(this.autoSelect ? 0 : -1);\n        if (!keepPopupPosition) {\n            this.popup.setTheme(editor.getTheme());\n            this.popup.setFontSize(editor.getFontSize());\n\n            var lineHeight = renderer.layerConfig.lineHeight;\n\n            var pos = renderer.$cursorLayer.getPixelPosition(this.base, true);\n            pos.left -= this.popup.getTextLeftOffset();\n\n            var rect = editor.container.getBoundingClientRect();\n            pos.top += rect.top - renderer.layerConfig.offset;\n            pos.left += rect.left - editor.renderer.scrollLeft;\n            pos.left += renderer.gutterWidth;\n\n            this.popup.show(pos, lineHeight);\n        } else if (keepPopupPosition && !prefix) {\n            this.detach();\n        }\n    };\n\n    this.detach = function() {\n        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);\n        this.editor.off(\"changeSelection\", this.changeListener);\n        this.editor.off(\"blur\", this.blurListener);\n        this.editor.off(\"mousedown\", this.mousedownListener);\n        this.editor.off(\"mousewheel\", this.mousewheelListener);\n        this.changeTimer.cancel();\n        this.hideDocTooltip();\n\n        this.gatherCompletionsId += 1;\n        if (this.popup && this.popup.isOpen)\n            this.popup.hide();\n\n        if (this.base)\n            this.base.detach();\n        this.activated = false;\n        this.completions = this.base = null;\n    };\n\n    this.changeListener = function(e) {\n        var cursor = this.editor.selection.lead;\n        if (cursor.row != this.base.row || cursor.column < this.base.column) {\n            this.detach();\n        }\n        if (this.activated)\n            this.changeTimer.schedule();\n        else\n            this.detach();\n    };\n\n    this.blurListener = function(e) {\n        if (e.relatedTarget && e.relatedTarget.nodeName == \"A\" && e.relatedTarget.href) {\n            window.open(e.relatedTarget.href, \"_blank\");\n        }\n        var el = document.activeElement;\n        var text = this.editor.textInput.getElement();\n        var fromTooltip = e.relatedTarget && e.relatedTarget == this.tooltipNode;\n        var container = this.popup && this.popup.container;\n        if (el != text && el.parentNode != container && !fromTooltip\n            && el != this.tooltipNode && e.relatedTarget != text\n        ) {\n            this.detach();\n        }\n    };\n\n    this.mousedownListener = function(e) {\n        this.detach();\n    };\n\n    this.mousewheelListener = function(e) {\n        this.detach();\n    };\n\n    this.goTo = function(where) {\n        var row = this.popup.getRow();\n        var max = this.popup.session.getLength() - 1;\n\n        switch(where) {\n            case \"up\": row = row <= 0 ? max : row - 1; break;\n            case \"down\": row = row >= max ? -1 : row + 1; break;\n            case \"start\": row = 0; break;\n            case \"end\": row = max; break;\n        }\n\n        this.popup.setRow(row);\n    };\n\n    this.insertMatch = function(data, options) {\n        if (!data)\n            data = this.popup.getData(this.popup.getRow());\n        if (!data)\n            return false;\n\n        if (data.completer && data.completer.insertMatch) {\n            data.completer.insertMatch(this.editor, data);\n        } else {\n            if (this.completions.filterText) {\n                var ranges = this.editor.selection.getAllRanges();\n                for (var i = 0, range; range = ranges[i]; i++) {\n                    range.start.column -= this.completions.filterText.length;\n                    this.editor.session.remove(range);\n                }\n            }\n            if (data.snippet)\n                snippetManager.insertSnippet(this.editor, data.snippet);\n            else\n                this.editor.execCommand(\"insertstring\", data.value || data);\n        }\n        this.detach();\n    };\n\n\n    this.commands = {\n        \"Up\": function(editor) { editor.completer.goTo(\"up\"); },\n        \"Down\": function(editor) { editor.completer.goTo(\"down\"); },\n        \"Ctrl-Up|Ctrl-Home\": function(editor) { editor.completer.goTo(\"start\"); },\n        \"Ctrl-Down|Ctrl-End\": function(editor) { editor.completer.goTo(\"end\"); },\n\n        \"Esc\": function(editor) { editor.completer.detach(); },\n        \"Return\": function(editor) { return editor.completer.insertMatch(); },\n        \"Shift-Return\": function(editor) { editor.completer.insertMatch(null, {deleteSuffix: true}); },\n        \"Tab\": function(editor) {\n            var result = editor.completer.insertMatch();\n            if (!result && !editor.tabstopManager)\n                editor.completer.goTo(\"down\");\n            else\n                return result;\n        },\n\n        \"PageUp\": function(editor) { editor.completer.popup.gotoPageUp(); },\n        \"PageDown\": function(editor) { editor.completer.popup.gotoPageDown(); }\n    };\n\n    this.gatherCompletions = function(editor, callback) {\n        var session = editor.getSession();\n        var pos = editor.getCursorPosition();\n\n        var line = session.getLine(pos.row);\n        var prefix = util.getCompletionPrefix(editor);\n\n        this.base = session.doc.createAnchor(pos.row, pos.column - prefix.length);\n        this.base.$insertRight = true;\n\n        var matches = [];\n        var total = editor.completers.length;\n        editor.completers.forEach(function(completer, i) {\n            completer.getCompletions(editor, session, pos, prefix, function(err, results) {\n                if (!err && results)\n                    matches = matches.concat(results);\n                var pos = editor.getCursorPosition();\n                var line = session.getLine(pos.row);\n                callback(null, {\n                    prefix: prefix,\n                    matches: matches,\n                    finished: (--total === 0)\n                });\n            });\n        });\n        return true;\n    };\n\n    this.showPopup = function(editor) {\n        if (this.editor)\n            this.detach();\n\n        this.activated = true;\n\n        this.editor = editor;\n        if (editor.completer != this) {\n            if (editor.completer)\n                editor.completer.detach();\n            editor.completer = this;\n        }\n\n        editor.on(\"changeSelection\", this.changeListener);\n        editor.on(\"blur\", this.blurListener);\n        editor.on(\"mousedown\", this.mousedownListener);\n        editor.on(\"mousewheel\", this.mousewheelListener);\n\n        this.updateCompletions();\n    };\n\n    this.updateCompletions = function(keepPopupPosition) {\n        if (keepPopupPosition && this.base && this.completions) {\n            var pos = this.editor.getCursorPosition();\n            var prefix = this.editor.session.getTextRange({start: this.base, end: pos});\n            if (prefix == this.completions.filterText)\n                return;\n            this.completions.setFilter(prefix);\n            if (!this.completions.filtered.length)\n                return this.detach();\n            if (this.completions.filtered.length == 1\n            && this.completions.filtered[0].value == prefix\n            && !this.completions.filtered[0].snippet)\n                return this.detach();\n            this.openPopup(this.editor, prefix, keepPopupPosition);\n            return;\n        }\n        var _id = this.gatherCompletionsId;\n        this.gatherCompletions(this.editor, function(err, results) {\n            var detachIfFinished = function() {\n                if (!results.finished) return;\n                return this.detach();\n            }.bind(this);\n\n            var prefix = results.prefix;\n            var matches = results && results.matches;\n\n            if (!matches || !matches.length)\n                return detachIfFinished();\n            if (prefix.indexOf(results.prefix) !== 0 || _id != this.gatherCompletionsId)\n                return;\n\n            this.completions = new FilteredList(matches);\n\n            if (this.exactMatch)\n                this.completions.exactMatch = true;\n\n            this.completions.setFilter(prefix);\n            var filtered = this.completions.filtered;\n            if (!filtered.length)\n                return detachIfFinished();\n            if (filtered.length == 1 && filtered[0].value == prefix && !filtered[0].snippet)\n                return detachIfFinished();\n            if (this.autoInsert && filtered.length == 1 && results.finished)\n                return this.insertMatch(filtered[0]);\n\n            this.openPopup(this.editor, prefix, keepPopupPosition);\n        }.bind(this));\n    };\n\n    this.cancelContextMenu = function() {\n        this.editor.$mouseHandler.cancelContextMenu();\n    };\n\n    this.updateDocTooltip = function() {\n        var popup = this.popup;\n        var all = popup.data;\n        var selected = all && (all[popup.getHoveredRow()] || all[popup.getRow()]);\n        var doc = null;\n        if (!selected || !this.editor || !this.popup.isOpen)\n            return this.hideDocTooltip();\n        this.editor.completers.some(function(completer) {\n            if (completer.getDocTooltip)\n                doc = completer.getDocTooltip(selected);\n            return doc;\n        });\n        if (!doc)\n            doc = selected;\n\n        if (typeof doc == \"string\")\n            doc = {docText: doc};\n        if (!doc || !(doc.docHTML || doc.docText))\n            return this.hideDocTooltip();\n        this.showDocTooltip(doc);\n    };\n\n    this.showDocTooltip = function(item) {\n        if (!this.tooltipNode) {\n            this.tooltipNode = dom.createElement(\"div\");\n            this.tooltipNode.className = \"ace_tooltip ace_doc-tooltip\";\n            this.tooltipNode.style.margin = 0;\n            this.tooltipNode.style.pointerEvents = \"auto\";\n            this.tooltipNode.tabIndex = -1;\n            this.tooltipNode.onblur = this.blurListener.bind(this);\n        }\n\n        var tooltipNode = this.tooltipNode;\n        if (item.docHTML) {\n            tooltipNode.innerHTML = item.docHTML;\n        } else if (item.docText) {\n            tooltipNode.textContent = item.docText;\n        }\n\n        if (!tooltipNode.parentNode)\n            document.body.appendChild(tooltipNode);\n        var popup = this.popup;\n        var rect = popup.container.getBoundingClientRect();\n        tooltipNode.style.top = popup.container.style.top;\n        tooltipNode.style.bottom = popup.container.style.bottom;\n\n        if (window.innerWidth - rect.right < 320) {\n            tooltipNode.style.right = window.innerWidth - rect.left + \"px\";\n            tooltipNode.style.left = \"\";\n        } else {\n            tooltipNode.style.left = (rect.right + 1) + \"px\";\n            tooltipNode.style.right = \"\";\n        }\n        tooltipNode.style.display = \"block\";\n    };\n\n    this.hideDocTooltip = function() {\n        this.tooltipTimer.cancel();\n        if (!this.tooltipNode) return;\n        var el = this.tooltipNode;\n        if (!this.editor.isFocused() && document.activeElement == el)\n            this.editor.focus();\n        this.tooltipNode = null;\n        if (el.parentNode)\n            el.parentNode.removeChild(el);\n    };\n\n}).call(Autocomplete.prototype);\n\nAutocomplete.startCommand = {\n    name: \"startAutocomplete\",\n    exec: function(editor) {\n        if (!editor.completer)\n            editor.completer = new Autocomplete();\n        editor.completer.autoInsert = false;\n        editor.completer.autoSelect = true;\n        editor.completer.showPopup(editor);\n        editor.completer.cancelContextMenu();\n    },\n    bindKey: \"Ctrl-Space|Ctrl-Shift-Space|Alt-Space\"\n};\n\nvar FilteredList = function(array, filterText) {\n    this.all = array;\n    this.filtered = array;\n    this.filterText = filterText || \"\";\n    this.exactMatch = false;\n};\n(function(){\n    this.setFilter = function(str) {\n        if (str.length > this.filterText && str.lastIndexOf(this.filterText, 0) === 0)\n            var matches = this.filtered;\n        else\n            var matches = this.all;\n\n        this.filterText = str;\n        matches = this.filterCompletions(matches, this.filterText);\n        matches = matches.sort(function(a, b) {\n            return b.exactMatch - a.exactMatch || b.score - a.score;\n        });\n        var prev = null;\n        matches = matches.filter(function(item){\n            var caption = item.snippet || item.caption || item.value;\n            if (caption === prev) return false;\n            prev = caption;\n            return true;\n        });\n\n        this.filtered = matches;\n    };\n    this.filterCompletions = function(items, needle) {\n        var results = [];\n        var upper = needle.toUpperCase();\n        var lower = needle.toLowerCase();\n        loop: for (var i = 0, item; item = items[i]; i++) {\n            var caption = item.value || item.caption || item.snippet;\n            if (!caption) continue;\n            var lastIndex = -1;\n            var matchMask = 0;\n            var penalty = 0;\n            var index, distance;\n\n            if (this.exactMatch) {\n                if (needle !== caption.substr(0, needle.length))\n                    continue loop;\n            }else{\n                for (var j = 0; j < needle.length; j++) {\n                    var i1 = caption.indexOf(lower[j], lastIndex + 1);\n                    var i2 = caption.indexOf(upper[j], lastIndex + 1);\n                    index = (i1 >= 0) ? ((i2 < 0 || i1 < i2) ? i1 : i2) : i2;\n                    if (index < 0)\n                        continue loop;\n                    distance = index - lastIndex - 1;\n                    if (distance > 0) {\n                        if (lastIndex === -1)\n                            penalty += 10;\n                        penalty += distance;\n                    }\n                    matchMask = matchMask | (1 << index);\n                    lastIndex = index;\n                }\n            }\n            item.matchMask = matchMask;\n            item.exactMatch = penalty ? 0 : 1;\n            item.score = (item.score || 0) - penalty;\n            results.push(item);\n        }\n        return results;\n    };\n}).call(FilteredList.prototype);\n\nexports.Autocomplete = Autocomplete;\nexports.FilteredList = FilteredList;\n\n});\n\ndefine(\"ace/autocomplete/text_completer\",[\"require\",\"exports\",\"module\",\"ace/range\"], function(require, exports, module) {\n    var Range = require(\"../range\").Range;\n    \n    var splitRegex = /[^a-zA-Z_0-9\\$\\-\\u00C0-\\u1FFF\\u2C00-\\uD7FF\\w]+/;\n\n    function getWordIndex(doc, pos) {\n        var textBefore = doc.getTextRange(Range.fromPoints({row: 0, column:0}, pos));\n        return textBefore.split(splitRegex).length - 1;\n    }\n    function wordDistance(doc, pos) {\n        var prefixPos = getWordIndex(doc, pos);\n        var words = doc.getValue().split(splitRegex);\n        var wordScores = Object.create(null);\n        \n        var currentWord = words[prefixPos];\n\n        words.forEach(function(word, idx) {\n            if (!word || word === currentWord) return;\n\n            var distance = Math.abs(prefixPos - idx);\n            var score = words.length - distance;\n            if (wordScores[word]) {\n                wordScores[word] = Math.max(score, wordScores[word]);\n            } else {\n                wordScores[word] = score;\n            }\n        });\n        return wordScores;\n    }\n\n    exports.getCompletions = function(editor, session, pos, prefix, callback) {\n        var wordScore = wordDistance(session, pos, prefix);\n        var wordList = Object.keys(wordScore);\n        callback(null, wordList.map(function(word) {\n            return {\n                caption: word,\n                value: word,\n                score: wordScore[word],\n                meta: \"local\"\n            };\n        }));\n    };\n});\n\ndefine(\"ace/ext/language_tools\",[\"require\",\"exports\",\"module\",\"ace/snippets\",\"ace/autocomplete\",\"ace/config\",\"ace/lib/lang\",\"ace/autocomplete/util\",\"ace/autocomplete/text_completer\",\"ace/editor\",\"ace/config\"], function(require, exports, module) {\n\"use strict\";\n\nvar snippetManager = require(\"../snippets\").snippetManager;\nvar Autocomplete = require(\"../autocomplete\").Autocomplete;\nvar config = require(\"../config\");\nvar lang = require(\"../lib/lang\");\nvar util = require(\"../autocomplete/util\");\n\nvar textCompleter = require(\"../autocomplete/text_completer\");\nvar keyWordCompleter = {\n    getCompletions: function(editor, session, pos, prefix, callback) {\n        if (session.$mode.completer) {\n            return session.$mode.completer.getCompletions(editor, session, pos, prefix, callback);\n        }\n        var state = editor.session.getState(pos.row);\n        var completions = session.$mode.getCompletions(state, session, pos, prefix);\n        callback(null, completions);\n    }\n};\n\nvar snippetCompleter = {\n    getCompletions: function(editor, session, pos, prefix, callback) {\n        var snippetMap = snippetManager.snippetMap;\n        var completions = [];\n        snippetManager.getActiveScopes(editor).forEach(function(scope) {\n            var snippets = snippetMap[scope] || [];\n            for (var i = snippets.length; i--;) {\n                var s = snippets[i];\n                var caption = s.name || s.tabTrigger;\n                if (!caption)\n                    continue;\n                completions.push({\n                    caption: caption,\n                    snippet: s.content,\n                    meta: s.tabTrigger && !s.name ? s.tabTrigger + \"\\u21E5 \" : \"snippet\",\n                    type: \"snippet\"\n                });\n            }\n        }, this);\n        callback(null, completions);\n    },\n    getDocTooltip: function(item) {\n        if (item.type == \"snippet\" && !item.docHTML) {\n            item.docHTML = [\n                \"<b>\", lang.escapeHTML(item.caption), \"</b>\", \"<hr></hr>\",\n                lang.escapeHTML(item.snippet)\n            ].join(\"\");\n        }\n    }\n};\n\nvar completers = [snippetCompleter, textCompleter, keyWordCompleter];\nexports.setCompleters = function(val) {\n    completers.length = 0;\n    if (val) completers.push.apply(completers, val);\n};\nexports.addCompleter = function(completer) {\n    completers.push(completer);\n};\nexports.textCompleter = textCompleter;\nexports.keyWordCompleter = keyWordCompleter;\nexports.snippetCompleter = snippetCompleter;\n\nvar expandSnippet = {\n    name: \"expandSnippet\",\n    exec: function(editor) {\n        return snippetManager.expandWithTab(editor);\n    },\n    bindKey: \"Tab\"\n};\n\nvar onChangeMode = function(e, editor) {\n    loadSnippetsForMode(editor.session.$mode);\n};\n\nvar loadSnippetsForMode = function(mode) {\n    var id = mode.$id;\n    if (!snippetManager.files)\n        snippetManager.files = {};\n    loadSnippetFile(id);\n    if (mode.modes)\n        mode.modes.forEach(loadSnippetsForMode);\n};\n\nvar loadSnippetFile = function(id) {\n    if (!id || snippetManager.files[id])\n        return;\n    var snippetFilePath = id.replace(\"mode\", \"snippets\");\n    snippetManager.files[id] = {};\n    config.loadModule(snippetFilePath, function(m) {\n        if (m) {\n            snippetManager.files[id] = m;\n            if (!m.snippets && m.snippetText)\n                m.snippets = snippetManager.parseSnippetFile(m.snippetText);\n            snippetManager.register(m.snippets || [], m.scope);\n            if (m.includeScopes) {\n                snippetManager.snippetMap[m.scope].includeScopes = m.includeScopes;\n                m.includeScopes.forEach(function(x) {\n                    loadSnippetFile(\"ace/mode/\" + x);\n                });\n            }\n        }\n    });\n};\n\nvar doLiveAutocomplete = function(e) {\n    var editor = e.editor;\n    var hasCompleter = editor.completer && editor.completer.activated;\n    if (e.command.name === \"backspace\") {\n        if (hasCompleter && !util.getCompletionPrefix(editor))\n            editor.completer.detach();\n    }\n    else if (e.command.name === \"insertstring\") {\n        var prefix = util.getCompletionPrefix(editor);\n        if (prefix && !hasCompleter) {\n            if (!editor.completer) {\n                editor.completer = new Autocomplete();\n            }\n            editor.completer.autoInsert = false;\n            editor.completer.showPopup(editor);\n        }\n    }\n};\n\nvar Editor = require(\"../editor\").Editor;\nrequire(\"../config\").defineOptions(Editor.prototype, \"editor\", {\n    enableBasicAutocompletion: {\n        set: function(val) {\n            if (val) {\n                if (!this.completers)\n                    this.completers = Array.isArray(val)? val: completers;\n                this.commands.addCommand(Autocomplete.startCommand);\n            } else {\n                this.commands.removeCommand(Autocomplete.startCommand);\n            }\n        },\n        value: false\n    },\n    enableLiveAutocompletion: {\n        set: function(val) {\n            if (val) {\n                if (!this.completers)\n                    this.completers = Array.isArray(val)? val: completers;\n                this.commands.on('afterExec', doLiveAutocomplete);\n            } else {\n                this.commands.removeListener('afterExec', doLiveAutocomplete);\n            }\n        },\n        value: false\n    },\n    enableSnippets: {\n        set: function(val) {\n            if (val) {\n                this.commands.addCommand(expandSnippet);\n                this.on(\"changeMode\", onChangeMode);\n                onChangeMode(null, this);\n            } else {\n                this.commands.removeCommand(expandSnippet);\n                this.off(\"changeMode\", onChangeMode);\n            }\n        },\n        value: false\n    }\n});\n});\n                (function() {\n                    window.require([\"ace/ext/language_tools\"], function() {});\n                })();\n            "]}